<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜ê°ë…¸íŠ¸ by. chichiboo</title>
    
    <!-- í°íŠ¸: Pretendard Gov -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-gov.min.css" />
    <!-- íŒŒë¹„ì½˜: Material Symbol light (#255290) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'><path fill='%23255290' d='M480-120q-66 0-113-47t-47-113H200q-33 0-56.5-23.5T120-360q0-140 92-241.5T440-718v-122h80v122q136 15 228 116.5T840-360q0 33-23.5 56.5T760-280H640q0 66-47 113t-113 47ZM200-360h560q0-116-82-198t-198-82q-116 0-198 82t-82 198Zm280 160q33 0 56.5-23.5T560-280H400q0 33 23.5 56.5T480-200Zm0-80Z'/></svg>">
    <!-- ì•„ì´ì½˜: Remix Icon & Google Material Symbols -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=ev_shadow,light" />

    <style>
        /* ğŸ¨ ë””ìì¸ í† í° ë° í…Œë§ˆ ì„¤ì • */
        :root { --font-main: 'Pretendard GOV', sans-serif; --radius: 16px; --trans: all 0.2s ease; }
        
        [data-theme="blue"]   { --bg: #F0F4F8; --main: #7B9ACC; --sub: #E2EBF5; --text: #2C3E50; --card: #FFF; --grad: linear-gradient(135deg, #7B9ACC, #5A7AA0); }
        [data-theme="green"]  { --bg: #F1F8F5; --main: #8EBAA5; --sub: #E2EFE9; --text: #2D3E35; --card: #FFF; --grad: linear-gradient(135deg, #8EBAA5, #6E9A85); }
        [data-theme="yellow"] { --bg: #FFFDF5; --main: #E6C27A; --sub: #FDF3DB; --text: #4A4036; --card: #FFF; --grad: linear-gradient(135deg, #E6C27A, #C6A25A); }
        [data-theme="red"]    { --bg: #FEF5F5; --main: #E09494; --sub: #FADBD8; --text: #4A2C2C; --card: #FFF; --grad: linear-gradient(135deg, #E09494, #C07474); }
        [data-theme="dark"]   { --bg: #0f0f1a; --main: #7B9ACC; --sub: #1e1e35; --text: #dde2ec; --card: #16192b; --grad: linear-gradient(135deg, #3a5a8a, #2a4070); }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: var(--font-main); background: var(--bg); color: var(--text); margin: 0; padding: 0; transition: background 0.3s ease; }
        
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 100px;
            position: relative;
        }

        @media (min-width: 1024px) {
            .app-container { max-width: min(1400px, 95vw); }
        }

        .loader-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 9999; display: none; justify-content: center; align-items: center; flex-direction: column; }
        .loader { width: 45px; height: 45px; border: 4px solid #eee; border-top-color: var(--main); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        header { padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .app-title { font-size: 1.5rem; font-weight: 800; color: var(--main); display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .header-actions { display: flex; gap: 12px; align-items: center; }
        
        #connectionStatus { font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 20px; background: rgba(255,255,255,0.5); cursor: pointer; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: currentColor; }
        .status-error { color: #e74c3c; background: #fee; }
        .status-ok { color: #2e7d32; background: #e8f5e9; }
        .status-connecting { color: #f39c12; background: #fff8e1; }
        .status-offline { color: #666; background: #eee; }

        .icon-btn { background: none; border: none; font-size: 1.4rem; color: #999; padding: 4px; cursor: pointer; transition: var(--trans); }
        .icon-btn:hover { color: var(--main); transform: scale(1.1); }
        .theme-select { padding: 6px 12px; border-radius: 20px; border: 1px solid var(--main); background: var(--card); color: var(--main); font-weight: 700; outline: none; cursor: pointer; }

        .search-area { padding: 0 24px 15px; flex-shrink: 0; }
        .search-wrapper { position: relative; display: flex; align-items: center; width: 100%; }
        .search-input { width: 100%; padding: 14px 20px 14px 45px; border-radius: 24px; border: none; background: var(--card); box-shadow: 0 4px 15px rgba(0,0,0,0.04); font-size: 1rem; outline: none; transition: var(--trans); }
        .search-input:focus { box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .search-icon { position: absolute; left: 16px; color: var(--main); font-size: 1.2rem; pointer-events: none; display: flex; align-items: center; height: 100%; top: 0; }

        .dashboard-area { padding: 5px 24px 20px; flex-shrink: 0; }
        .dashboard-card { background: var(--grad); border-radius: 20px; padding: 20px 24px; color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.15); display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden; gap: 15px; }
        .dash-total { font-size: 2.2rem; font-weight: 800; line-height: 1.2; }
        .dash-stat-item { display: flex; flex-direction: column; align-items: center; }
        .dash-stat-label { font-size: 0.7rem; opacity: 0.8; margin-bottom: 2px; }
        .dash-stat-val { font-size: 1.1rem; font-weight: 700; }

        .tabs-area { padding: 0 24px 15px; display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; flex-shrink: 0; }
        .tab-btn { flex: 1; padding: 10px; text-align: center; border-radius: 20px; background: rgba(255,255,255,0.6); color: #888; font-weight: 700; font-size: 0.95rem; border: none; cursor: pointer; transition: var(--trans); white-space: nowrap; }
        .tab-btn.active { background: var(--main); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }

        .folders-section { padding: 0 24px 10px; display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
        .folder-manage-btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 14px; border-radius: 14px; background: var(--main); color: white; font-size: 0.85rem; font-weight: 700; border: none; cursor: pointer; transition: var(--trans); white-space: nowrap; }
        .folders-list { display: flex; overflow-x: auto; scrollbar-width: none; gap: 8px; }
        .folder-chip { display: inline-flex; align-items: center; padding: 10px 16px; border-radius: 14px; background: var(--card); border: 1px solid var(--sub); color: #666; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: var(--trans); }
        .folder-chip.active { background: var(--sub); color: var(--main); border-color: var(--main); font-weight: 700; }

        .toolbar { padding: 10px 24px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .view-opts { display: flex; background: var(--card); border-radius: 12px; padding: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .view-opts button { border: none; padding: 6px 12px; border-radius: 8px; background: transparent; color: #999; cursor: pointer; font-size: 1.1rem; }
        .view-opts button.active { background: var(--sub); color: var(--main); }
        .sort-select { padding: 8px 14px; border-radius: 14px; border: 1px solid var(--sub); background: var(--card); color: #555; font-size: 0.85rem; outline: none; cursor: pointer; appearance: none; font-weight: 600; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23999'%3e%3cpath d='M12 16L6 10H18L12 16Z'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 14px center; background-size: 20px; padding-right: 30px; }

        .grid-view { display: grid; gap: 20px; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-cols-3 .card-title, .grid-cols-4 .card-title { font-size: 1rem; }
        .grid-cols-3 .card-content, .grid-cols-4 .card-content { font-size: 0.85rem; -webkit-line-clamp: 3; }
        .grid-cols-4 .card-meta { font-size: 0.7rem; }
        .grid-cols-4 .card { padding: 16px; }

        /* ì¢ì€ í™”ë©´: ì¹´ë“œ ìµœì†Œ ë„ˆë¹„ ê¸°ì¤€ìœ¼ë¡œ ì—´ ìˆ˜ ìë™ ì¡°ì • */
        @media (max-width: 600px) {
            .grid-view { gap: 14px; }
            .grid-cols-2 { grid-template-columns: repeat(auto-fill, minmax(min(170px, 100%), 1fr)); }
            .grid-cols-3 { grid-template-columns: repeat(auto-fill, minmax(min(150px, 100%), 1fr)); }
            .grid-cols-4 { grid-template-columns: repeat(auto-fill, minmax(min(130px, 100%), 1fr)); }
        }
        
        /* ë¦¬ìŠ¤íŠ¸ ë·° ë ˆì´ì•„ì›ƒ */
        .list-view { display: flex; flex-direction: column; gap: 10px; }
        .list-item { 
            display: flex; align-items: flex-start; 
            background: var(--card); padding: 16px 20px; border-radius: 18px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.03); transition: var(--trans); 
            cursor: pointer; border: 1px solid transparent; 
            justify-content: space-between; gap: 15px;
            width: 100%;
        }
        .list-item:hover { transform: translateX(4px); border-color: var(--main); }
        .list-item-left { display: flex; align-items: flex-start; gap: 15px; flex: 1; min-width: 0; }
        .list-icon { 
            width: 44px; height: 44px; border-radius: 14px; 
            background: var(--sub); color: var(--main); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.3rem; flex-shrink: 0; margin-top: 2px;
        }
        .list-content-wrap { display: flex; flex-direction: column; gap: 4px; min-width: 0; flex: 1; }
        .list-title { font-size: 1.05rem; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .list-preview { font-size: 0.9rem; color: #777; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 2px; }
        .list-meta { font-size: 0.82rem; color: #999; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .list-meta .badge-text { font-weight: 800; color: var(--main); font-size: 0.75rem; }
        .list-tags { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 2px; }
        .list-tag { font-size: 0.75rem; color: var(--main); opacity: 0.8; font-weight: 600; }
        .list-actions { display: flex; gap: 8px; flex-shrink: 0; margin-top: 5px; }

        /* ì¹´ë“œ ë·° */
        .card { background: var(--card); border-radius: 20px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); transition: var(--trans); cursor: pointer; border: 1px solid transparent; display: flex; flex-direction: column; height: 100%; position: relative; overflow: hidden; }
        .card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.08); }
        .card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 5px; background: var(--main); opacity: 0.8; }
        .card-meta { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 0.8rem; color: #888; align-items: center; }
        .badge { padding: 4px 8px; border-radius: 6px; font-weight: 800; font-size: 0.65rem; margin-right: 4px; }
        .badge-cat { background: var(--sub); color: var(--main); }
        .badge-folder { background: #f0f0f0; color: #666; }
        .card-title { font-size: 1.15rem; font-weight: 700; color: var(--text); margin-bottom: 10px; line-height: 1.4; }
        .card-content { font-size: 0.95rem; line-height: 1.6; color: #555; margin-bottom: 15px; white-space: pre-wrap; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; flex-grow: 1; }
        .card-preview { width: 100%; height: 160px; border-radius: 12px; margin-bottom: 15px; background: #f8f9fa; overflow: hidden; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; }
        .card-preview img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-link { display: flex; align-items: center; gap: 6px; margin-top: auto; font-size: 0.8rem; color: var(--main); font-weight: 700; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding: 8px 12px; background: var(--bg); border-radius: 10px; margin-bottom: 10px; }
        
        /* ì¹´ë“œ í•˜ë‹¨ í•´ì‹œíƒœê·¸ì™€ ì„  ì‚¬ì´ ê°„ê²© ì¡°ì • */
        .card-tags { margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 5px; }

        .card-actions { margin-top: 5px; padding-top: 15px; border-top: 1px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 10px; }
        .action-btn { background: #f5f5f5; border: none; width: 36px; height: 36px; border-radius: 50%; color: #777; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--trans); }
        .action-btn:hover { background: var(--sub); color: var(--main); }
        .action-btn.del:hover { background: #fee; color: #e74c3c; }

        .empty-msg { margin: auto; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: #aaa; width: 100%; grid-column: 1 / -1; }
        .empty-msg i { font-size: 5rem; margin-bottom: 20px; color: var(--main); opacity: 0.4; }
        .empty-msg .material-symbols-outlined { font-size: 5rem; margin-bottom: 20px; color: var(--main); opacity: 0.4; }
        .empty-msg p { font-size: 1.1rem; font-weight: 600; margin: 0; line-height: 1.5; }

        /* ëª¨ë‹¬ ì‹œìŠ¤í…œ */
        .modal-wrap { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal-box { background: var(--card); width: 90%; max-width: 480px; border-radius: 24px; padding: 30px; max-height: 90vh; overflow-y: auto; animation: popIn 0.2s ease; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-size: 1.3rem; font-weight: 800; display: flex; align-items: center; gap: 10px; color: var(--text); }
        .close-btn { background: none; border: none; font-size: 1.6rem; color: #999; cursor: pointer; }
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-size: 0.9rem; font-weight: 700; color: #666; margin-bottom: 8px; }
        
        .form-input { width: 100%; padding: 14px; border-radius: 14px; border: 1px solid var(--sub); background: var(--bg); font-size: 1rem; outline: none; font-family: var(--font-main); color: var(--text); transition: all 0.2s; }
        .form-input:focus { border-color: var(--main); background: #fff; box-shadow: 0 0 0 3px rgba(0,0,0,0.03); }
        textarea.form-input { height: 120px; resize: none; line-height: 1.5; }
        .full-btn { width: 100%; padding: 16px; border-radius: 16px; background: var(--main); color: white; border: none; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 10px; transition: var(--trans); }
        #folderDeleteChoiceModal { z-index: 2100; }

        /* ë””ìì¸ ì¡°í™”: ì²¨ë¶€íŒŒì¼ ë° í•´ì‹œíƒœê·¸ ë””ìì¸ ìˆ˜ì • */
        .file-box { 
            border: 1px solid var(--sub); background: var(--bg);
            padding: 20px; border-radius: 14px; text-align: center; cursor: pointer; 
            color: #888; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px;
            font-weight: 600; font-size: 0.95rem; flex-direction: column;
            width: 100%;
        }
        .file-box:hover { border-color: var(--main); color: var(--main); background: #fff; }

        .tag-container {
            display: flex; flex-wrap: wrap; gap: 8px; padding: 10px 14px;
            border: 1px solid var(--sub); border-radius: 14px; background: var(--bg);
            min-height: 48px; align-items: center; cursor: text;
            transition: all 0.2s;
        }
        .tag-container:focus-within { border-color: var(--main); background: #fff; }
        .tag-block {
            background: var(--main); color: white; padding: 6px 12px; border-radius: 20px;
            font-size: 0.85rem; font-weight: 700; display: flex; align-items: center; gap: 6px;
        }
        .tag-input {
            border: none; background: transparent; outline: none; flex-grow: 1;
            font-family: var(--font-main); font-size: 0.95rem; min-width: 100px; color: var(--text);
        }

        .setting-tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid var(--sub); }
        .setting-tab { padding: 10px 15px; cursor: pointer; font-weight: 700; color: #999; border-bottom: 2px solid transparent; margin-bottom: -2px; }
        .setting-tab.active { color: var(--main); border-bottom-color: var(--main); }
        .setting-content { display: none; }
        .setting-content.active { display: block; animation: fadeIn 0.3s ease; }
        .modal-footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #aaa; font-size: 0.85rem; }
        .modal-footer a { color: inherit; text-decoration: none; font-weight: 600; transition: var(--trans); opacity: 0.7; }

        .toast-container { position: fixed; bottom: 110px; left: 50%; transform: translateX(-50%); z-index: 2000; width: 90%; max-width: 400px; pointer-events: none; }
        .toast { pointer-events: auto; background: rgba(33, 37, 41, 0.95); color: white; padding: 16px 24px; border-radius: 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: slideUp 0.3s ease; backdrop-filter: blur(4px); }
        
        .fab { position: fixed; bottom: 40px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--main); color: white; border: none; font-size: 26px; box-shadow: 0 6px 20px rgba(0,0,0,0.25); cursor: pointer; z-index: 100; display: flex; align-items: center; justify-content: center; transition: var(--trans); }
        
        /* ë‹¤í¬ëª¨ë“œ ì „ìš© ì˜¤ë²„ë¼ì´ë“œ */
        [data-theme="dark"] body { color: var(--text); }
        [data-theme="dark"] .form-input:focus { background: var(--card); box-shadow: 0 0 0 3px rgba(123,154,204,0.15); }
        [data-theme="dark"] .tag-container:focus-within { background: var(--card); }
        [data-theme="dark"] .card-content { color: #aaa; }
        [data-theme="dark"] .card-actions { border-top-color: var(--sub); }
        [data-theme="dark"] .action-btn { background: var(--sub); color: #aaa; }
        [data-theme="dark"] .card-preview { background: var(--sub); border-color: var(--sub); }
        [data-theme="dark"] .card:hover { box-shadow: 0 12px 30px rgba(0,0,0,0.4); }
        [data-theme="dark"] .list-item { border-color: var(--sub); box-shadow: none; }
        [data-theme="dark"] .list-preview { color: #888; }
        [data-theme="dark"] .list-meta { color: #777; }
        [data-theme="dark"] .tab-btn { background: rgba(255,255,255,0.07); color: #999; }
        [data-theme="dark"] #connectionStatus { background: rgba(255,255,255,0.08); }
        [data-theme="dark"] .file-box:hover { background: var(--sub); }
        [data-theme="dark"] .loader-overlay { background: rgba(0,0,0,0.88); }
        [data-theme="dark"] #loaderText { color: #bbb; }
        [data-theme="dark"] .empty-msg { color: #666; }
        [data-theme="dark"] .modal-box { border: 1px solid var(--sub); }
        [data-theme="dark"] .modal-footer { border-top-color: var(--sub); }
        [data-theme="dark"] .setting-tabs { border-bottom-color: var(--sub); }
        [data-theme="dark"] #detailContent { color: var(--text); }

        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
    </style>
</head>
<body>

<div class="loader-overlay" id="loader">
    <div class="loader"></div>
    <div id="loaderText" style="font-weight: 700; color: #555;">ë°ì´í„° ë™ê¸°í™” ì¤‘...</div>
</div>

<div class="app-container">
    <header>
        <div class="header-left">
            <h1 class="app-title" onclick="location.reload()"><svg xmlns="http://www.w3.org/2000/svg" height="1.8rem" viewBox="0 -960 960 960" width="1.8rem" style="fill:var(--main);vertical-align:middle;flex-shrink:0;"><path d="M480-120q-66 0-113-47t-47-113H200q-33 0-56.5-23.5T120-360q0-140 92-241.5T440-718v-122h80v122q136 15 228 116.5T840-360q0 33-23.5 56.5T760-280H640q0 66-47 113t-113 47ZM200-360h560q0-116-82-198t-198-82q-116 0-198 82t-82 198Zm280 160q33 0 56.5-23.5T560-280H400q0 33 23.5 56.5T480-200Zm0-80Z"/></svg> ì˜ê°ë…¸íŠ¸</h1>
        </div>
        <div class="header-actions">
            <div id="connectionStatus" onclick="openModal('settingsModal')"><span class="status-dot"></span> <span>ëŒ€ê¸° ì¤‘</span></div>
            <button class="icon-btn" onclick="openModal('settingsModal')" title="ì„¤ì •"><i class="ri-settings-4-line"></i></button>
            <select class="theme-select" id="themeSelector">
                <option value="blue">ë¸”ë£¨</option>
                <option value="green">ê·¸ë¦°</option>
                <option value="yellow">ì˜ë¡œìš°</option>
                <option value="red">ë ˆë“œ</option>
                <option value="dark">ë‹¤í¬</option>
            </select>
        </div>
    </header>

    <div class="search-area" id="searchContainer">
        <div class="search-wrapper">
            <div class="search-icon"><i class="ri-search-line"></i></div>
            <input type="search" class="search-input" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ë˜ëŠ” #í•´ì‹œíƒœê·¸" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
    </div>

    <div class="dashboard-area" id="dashboardArea">
        <div class="dashboard-card">
            <div class="dash-left">
                <span class="dash-label">Total Insight</span>
                <div class="dash-count-big dash-total" id="dashTotal">0</div>
            </div>
            <div class="dash-right">
                <div class="dash-stat-item"><span class="dash-stat-label">TEXT</span><span class="dash-stat-val" id="dashText">0</span></div>
                <div class="dash-stat-item"><span class="dash-stat-label">LIFE</span><span class="dash-stat-val" id="dashLife">0</span></div>
                <div class="dash-stat-item"><span class="dash-stat-label">ART/EDU</span><span class="dash-stat-val" id="dashArt">0</span></div>
            </div>
        </div>
    </div>

    <div class="tabs-area" id="tabsContainer">
        <button class="tab-btn active" onclick="setCategory('all')">ì „ì²´</button>
        <button class="tab-btn" onclick="setCategory('text')">ë¬¸ì¥/ë‹¨ì–´</button>
        <button class="tab-btn" onclick="setCategory('daily')">ì¼ìƒ</button>
        <button class="tab-btn" onclick="setCategory('art')">ì˜ˆìˆ /êµìœ¡</button>
    </div>

    <div class="folders-section">
        <button class="folder-manage-btn" onclick="openFolderManage()"><i class="ri-folder-settings-fill"></i> í´ë”ê´€ë¦¬</button>
        <div class="folders-list" id="foldersContainer"></div>
    </div>

    <div class="toolbar">
        <div class="view-opts">
            <button class="active" id="btnViewGrid2" onclick="event.stopPropagation(); setGridView(2)" title="2ì—´ ê·¸ë¦¬ë“œ"><i class="ri-grid-fill"></i></button>
            <button id="btnViewGrid3" onclick="event.stopPropagation(); setGridView(3)" title="3ì—´ ê·¸ë¦¬ë“œ" style="font-size:0.78rem;font-weight:800;letter-spacing:-0.5px;">3ì—´</button>
            <button id="btnViewGrid4" onclick="event.stopPropagation(); setGridView(4)" title="4ì—´ ê·¸ë¦¬ë“œ" style="font-size:0.78rem;font-weight:800;letter-spacing:-0.5px;">4ì—´</button>
            <button id="btnViewList" onclick="event.stopPropagation(); setViewMode('list')" title="ë¦¬ìŠ¤íŠ¸í˜•"><i class="ri-list-check"></i></button>
        </div>
        <select class="sort-select" id="sortSelector" onchange="setSortMode(this.value)">
            <option value="date-desc">ìµœì‹ ìˆœ</option>
            <option value="date-asc">ì˜¤ë˜ëœìˆœ</option>
            <option value="title-asc">ê°€ë‚˜ë‹¤ìˆœ</option>
        </select>
    </div>

    <div class="content-area" id="mainContent"></div>
    
    <button class="fab" id="fabBtn" onclick="openModal('writeModal')"><i class="ri-edit-2-fill"></i></button>
</div>

<div id="toastContainer" class="toast-container"></div>

<!-- í´ë” ì‚­ì œ ì„ íƒ ëª¨ë‹¬ -->
<div class="modal-wrap" id="folderDeleteChoiceModal">
    <div class="modal-box">
        <div class="modal-head">
            <span class="modal-title"><i class="ri-alert-fill" style="color:#e74c3c"></i> ì‚­ì œ í™•ì¸</span>
            <button class="close-btn" onclick="closeModal('folderDeleteChoiceModal')"><i class="ri-close-line"></i></button>
        </div>
        <p id="deleteChoiceText" style="line-height:1.6; color:#555;"></p>
        <div class="choice-btns">
            <button class="full-btn" style="background:var(--main);" id="btnMoveToUnassigned">ë©”ëª¨ë¥¼ [ê¸°íƒ€]ë¡œ ì˜®ê¸°ê³  í´ë”ë§Œ ì‚­ì œ</button>
            <button class="full-btn" id="btnDeleteAllNotes" style="color:#e74c3c; background:#fee; border:1px solid #ffcccc; margin-top:10px;">ë‚´ë¶€ ë©”ëª¨ê¹Œì§€ ëª¨ë‘ ì‚­ì œ</button>
        </div>
    </div>
</div>

<!-- í´ë” ê´€ë¦¬ ëª¨ë‹¬ -->
<div class="modal-wrap" id="folderManageModal">
    <div class="modal-box">
        <div class="modal-head">
            <span class="modal-title"><i class="ri-folder-settings-line"></i> í´ë” ê´€ë¦¬</span>
            <button class="close-btn" onclick="closeModal('folderManageModal')"><i class="ri-close-line"></i></button>
        </div>
        <div class="form-group">
            <label class="form-label">ìƒˆ í´ë” ì¶”ê°€</label>
            <div style="display:flex; gap:8px;">
                <input type="text" class="form-input" id="newFolderName" placeholder="ì´ë¦„ ì…ë ¥">
                <button class="folder-manage-btn" style="padding:0 20px" onclick="addFolder()">ì¶”ê°€</button>
            </div>
        </div>
        <div id="manageFolderList"></div>
    </div>
</div>

<div class="modal-wrap" id="writeModal">
    <div class="modal-box">
        <div class="modal-head">
            <span class="modal-title" id="modalTitle"><svg xmlns="http://www.w3.org/2000/svg" height="1.4rem" viewBox="0 -960 960 960" width="1.4rem" style="fill:var(--main);flex-shrink:0;"><path d="M480-120q-66 0-113-47t-47-113H200q-33 0-56.5-23.5T120-360q0-140 92-241.5T440-718v-122h80v122q136 15 228 116.5T840-360q0 33-23.5 56.5T760-280H640q0 66-47 113t-113 47ZM200-360h560q0-116-82-198t-198-82q-116 0-198 82t-82 198Zm280 160q33 0 56.5-23.5T560-280H400q0 33 23.5 56.5T480-200Zm0-80Z"/></svg> ìƒˆë¡œìš´ ì˜ê°</span>
            <button class="close-btn" onclick="closeModal('writeModal')"><i class="ri-close-line"></i></button>
        </div>
        <input type="hidden" id="editNoteId">
        <div class="form-group">
            <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
            <select class="form-input" id="inputCategory">
                <option value="text">ë¬¸ì¥/ë‹¨ì–´</option>
                <option value="daily">ì¼ìƒ</option>
                <option value="art">ì˜ˆìˆ /êµìœ¡</option>
            </select>
        </div>
        <div class="form-group"><label class="form-label">í´ë”</label><select class="form-input" id="folderSelect"></select></div>
        <div class="form-group"><label class="form-label">ì œëª© / ì¶œì²˜</label><input type="text" class="form-input" id="inputTitle" placeholder="ì œëª©"></div>
        <div class="form-group"><label class="form-label">ë‚´ìš©</label><textarea class="form-input" id="inputContent" placeholder="ë‚´ìš©ì„ ê¸°ë¡í•˜ì„¸ìš”"></textarea></div>
        <div class="form-group"><label class="form-label">ë§í¬</label><input type="url" class="form-input" id="inputLink" placeholder="https://..."></div>
        <div class="form-group">
            <label class="form-label">ì²¨ë¶€íŒŒì¼</label>
            <label class="file-box" id="fileUploadBtn">
                <i class="ri-file-add-line" style="font-size:1.6rem;"></i>
                <span>ì´ë¯¸ì§€Â·PDF ë“± íŒŒì¼ ì„ íƒ ë˜ëŠ” Ctrl+V ë¶™ì—¬ë„£ê¸° (ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥)</span>
                <input type="file" id="inputFile" style="display:none" multiple onchange="handleFileSelect(this)">
            </label>
            <div id="filePreviewArea" style="display:none; margin-top:10px; flex-wrap:wrap; gap:8px;"></div>
        </div>
        <div class="form-group">
            <label class="form-label">í•´ì‹œíƒœê·¸</label>
            <div class="tag-container" id="tagInputContainer" onclick="document.getElementById('realTagInput').focus()">
                <input type="text" class="tag-input" id="realTagInput" placeholder="íƒœê·¸ ì…ë ¥ í›„ ì‰¼í‘œ(,)">
            </div>
        </div>
        <button class="full-btn" onclick="saveNote()">ì €ì¥í•˜ê¸°</button>
    </div>
</div>

<div class="modal-wrap" id="settingsModal">
    <div class="modal-box">
        <div class="modal-head">
            <span class="modal-title">âš™ï¸ ì„¤ì •</span>
            <button class="close-btn" onclick="closeModal('settingsModal')"><i class="ri-close-line"></i></button>
        </div>
        <div class="setting-tabs">
            <div class="setting-tab active" onclick="switchSettingTab('server')" id="tabServer">ì„œë²„ ì—°ë™</div>
            <div class="setting-tab" onclick="switchSettingTab('data')" id="tabData">ë°ì´í„° ê´€ë¦¬</div>
        </div>
        <div class="setting-content active" id="contentServer">
            <div class="form-group">
                <label class="form-label">Google ì›¹ ì•± URL</label>
                <input type="text" class="form-input" id="settingUrlInput" name="gas_server_url" placeholder="https://script.google.com/macros/s/..." autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label">ì•¡ì„¸ìŠ¤ í‚¤ (ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸)</label>
                <input type="password" class="form-input" id="settingKeyInput" name="gas_server_key" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            </div>
            <div style="display:flex; flex-direction: column; gap:10px;">
                <div style="display:flex; gap:10px;">
                    <button type="button" class="full-btn" onclick="saveSettings()">ì—°ë™í•˜ê¸°</button>
                    <button type="button" class="full-btn" style="background:#eee; color:#555;" onclick="enableOfflineMode()">ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ì‹œì‘</button>
                </div>
                <button type="button" class="full-btn" style="background:#fee; color:#e74c3c; margin-top:10px; display:none;" id="disconnectBtn" onclick="disconnectServer()">
                    <i class="ri-logout-box-line"></i> ì•±ìŠ¤í¬ë¦½íŠ¸ ì—°ë™ í•´ì œ (ë¡œê·¸ì•„ì›ƒ)
                </button>
            </div>
        </div>
        <div class="setting-content" id="contentData">
            <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ê±°ë‚˜ ë³µêµ¬í•©ë‹ˆë‹¤.</p>
            <button class="full-btn" style="background:var(--main);" onclick="exportData()">ë°ì´í„° ë°±ì—…</button>
            <div class="form-group" style="margin-top:15px;">
                <label class="file-box" style="border-style:dashed;">
                    <span>ë°±ì—… íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° (.json)</span>
                    <input type="file" id="jsonInput" style="display:none" accept=".json" onchange="importData(this)">
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <a href="https://litt.ly/chichiboo" target="_blank">Created by. êµìœ¡ë®¤ì§€ì»¬ ê¿ˆê¾¸ëŠ” ì¹˜ìˆ˜ìŒ¤</a>
        </div>
    </div>
</div>

<div class="modal-wrap" id="detailModal">
    <div class="modal-box">
        <div class="modal-head">
            <span class="modal-title" id="detailModalHeaderTitle"></span>
            <button class="close-btn" onclick="closeModal('detailModal')"><i class="ri-close-line"></i></button>
        </div>
        <div id="detailContent"></div>
    </div>
</div>

<script>
    // --- ìœ í‹¸ë¦¬í‹° ---
    function escapeHtml(s) {
        return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }

    // --- ì „ì—­ ìƒíƒœ ---
    let webAppUrl = localStorage.getItem('inspirationNote_Url') || ""; 
    let accessKey = localStorage.getItem('inspirationNote_Key') || "";
    let isOfflineMode = localStorage.getItem('inspirationNote_Offline') === 'true'; 
    let notes = [];
    let _savedFolders = JSON.parse(localStorage.getItem('inspirationFolders'));
    let customFolders = _savedFolders && _savedFolders.length
        ? _savedFolders
        : ["ì•„ì´ë””ì–´", "ë®¤ì§€ì»¬", "ë…ì„œ", "êµìœ¡", "ë””ì§€í„¸", "ìƒê°"];
    // 'ìƒê°' í´ë” ë§ˆì´ê·¸ë ˆì´ì…˜ (ê¸°ì¡´ ì‚¬ìš©ì)
    if (!customFolders.includes('ìƒê°')) {
        customFolders.push('ìƒê°');
        localStorage.setItem('inspirationFolders', JSON.stringify(customFolders));
    }
    let viewState = { cat: 'all', folder: 'all', mode: 'grid', gridCols: parseInt(localStorage.getItem('gridCols')) || 2, sort: 'date-desc', search: '' };
    let currentTags = [];
    let tempFiles = [];

    const catMap = { 'text': 'TEXT', 'daily': 'LIFE', 'art': 'ART&EDU' };
    const catName = { 'text': 'ë¬¸ì¥/ë‹¨ì–´', 'daily': 'ì¼ìƒ', 'art': 'ì˜ˆìˆ /êµìœ¡' };
    const catIcon = { 'text': 'ri-text', 'daily': 'ri-cup-line', 'art': 'ri-palette-line' };

    document.addEventListener('DOMContentLoaded', () => {
        // ë¸Œë¼ìš°ì € ìë™ì™„ì„± ì°¨ë‹¨: ì¦‰ì‹œ + ë‹¤ì¤‘ íƒ€ì´ë°ìœ¼ë¡œ í´ë¦¬ì–´
        const searchInput = document.getElementById('searchInput');
        const clearSearch = () => { if(searchInput && searchInput.value) { searchInput.value = ''; viewState.search = ''; } };
        clearSearch();
        setTimeout(clearSearch, 100);
        setTimeout(clearSearch, 500);
        setTimeout(clearSearch, 1000);

        initApp();

        // ì´ˆê¸°í™” ì™„ë£Œ í›„ì—ë§Œ input ì´ë²¤íŠ¸ ì—°ê²° (ìë™ì™„ì„± ì…ë ¥ ë¬´ì‹œ)
        let inputReady = false;
        setTimeout(() => { inputReady = true; }, 1200);
        searchInput.addEventListener('input', (e) => {
            if (!inputReady && e.target.value.startsWith('http')) { e.target.value = ''; return; }
            viewState.search = e.target.value;
            refreshUI();
        });
        document.getElementById('themeSelector').addEventListener('change', (e) => setTheme(e.target.value));
        document.getElementById('realTagInput').addEventListener('keydown', handleTagInput);
        document.getElementById('realTagInput').addEventListener('input', handleTagComma);
        document.addEventListener('paste', handlePaste);

        // ìƒì„¸ë³´ê¸° ëª¨ë‹¬: ë°”ê¹¥ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        document.getElementById('detailModal').addEventListener('click', (e) => {
            if (e.target.id === 'detailModal') closeModal('detailModal');
        });
        // ë’¤ë¡œê°€ê¸°ë¡œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
        window.addEventListener('popstate', () => {
            if (document.getElementById('detailModal').style.display === 'flex')
                document.getElementById('detailModal').style.display = 'none';
        });
    });

    function initApp() {
        webAppUrl = localStorage.getItem('inspirationNote_Url') || "";
        accessKey = localStorage.getItem('inspirationNote_Key') || "";
        isOfflineMode = localStorage.getItem('inspirationNote_Offline') === 'true';

        const t = localStorage.getItem('theme') || 'blue';
        setTheme(t);
        document.getElementById('themeSelector').value = t;
        
        document.getElementById('disconnectBtn').style.display = (webAppUrl && accessKey) ? 'block' : 'none';

        if (isOfflineMode) {
            updateStatusUI('offline');
            loadFromCache(); 
        } else if (webAppUrl && accessKey) {
            fetchNotes(); 
        } else {
            updateStatusUI('error', 'ì„¤ì • í•„ìš”');
            refreshUI();
            setTimeout(() => { if(!webAppUrl && !isOfflineMode) openModal('settingsModal'); }, 500);
        }
        renderFolders();
        // ê·¸ë¦¬ë“œ ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ë³µì›
        document.querySelectorAll('.view-opts button').forEach(b => b.classList.remove('active'));
        const _gb = viewState.mode === 'list'
            ? document.getElementById('btnViewList')
            : document.getElementById('btnViewGrid' + viewState.gridCols);
        if (_gb) _gb.classList.add('active');
    }

    function setTheme(t) { document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); }

    function updateStatusUI(type, text) {
        const el = document.getElementById('connectionStatus');
        if (!el) return;
        if (type === 'offline') {
            el.className = 'status-offline';
            el.innerHTML = '<i class="ri-hard-drive-line"></i> <span>ë¡œì»¬ ëª¨ë“œ</span>';
        } else {
            el.className = `status-${type}`;
            el.innerHTML = `<span class="status-dot"></span> <span>${text || (type === 'ok' ? 'ì—°ê²°ë¨' : 'ì˜¤ë¥˜')}</span>`;
        }
    }

    async function fetchNotes() {
        if (!webAppUrl || isOfflineMode) return;
        updateStatusUI('connecting', 'ë™ê¸°í™” ì¤‘...');
        showLoader(true);
        
        try {
            const params = new URLSearchParams({ action: 'read', key: accessKey, t: Date.now() });
            const res = await fetch(`${webAppUrl}?${params.toString()}`, { redirect: "follow" });
            const json = await res.json();

            if (json.status === "success") {
                const prevUrls = {};
                notes.forEach(n => { if (n.file_urls?.length > 1) prevUrls[n.id] = n.file_urls; });
                notes = json.data.map(n => ({
                    ...n, id: String(n.id),
                    tags: typeof n.tags === 'string' ? n.tags.split(',').filter(t=>t) : (n.tags || []),
                    deleted_at: null,
                    ...(prevUrls[String(n.id)] ? { file_urls: prevUrls[String(n.id)] } : {})
                }));
                // ì„œë²„ í´ë” ë™ê¸°í™”
                if (Array.isArray(json.folders) && json.folders.length > 0) {
                    // ì„œë²„ì— ì €ì¥ëœ í´ë”ê°€ ìˆìœ¼ë©´ ì„œë²„ ê¸°ì¤€ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    customFolders = json.folders;
                    localStorage.setItem('inspirationFolders', JSON.stringify(customFolders));
                    renderFolders();
                } else if (json.folders === null) {
                    // ì„œë²„ì— í´ë”ê°€ ì—†ìŒ (ìµœì´ˆ ì—°ë™) â†’ ë¡œì»¬ í´ë”ë¥¼ ì„œë²„ë¡œ ì—…ë¡œë“œ
                    syncFolders();
                }
                saveToCache(notes);
                updateStatusUI('ok');
                refreshUI();
            } else { throw new Error(json.message); }
        } catch (e) {
            updateStatusUI('error', 'ì—°ê²° ì‹¤íŒ¨');
            loadFromCache();
        } finally { showLoader(false); }
    }

    function disconnectServer() {
        if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        localStorage.removeItem('inspirationNote_Url');
        localStorage.removeItem('inspirationNote_Key');
        localStorage.removeItem('inspirationNote_Offline');
        localStorage.removeItem('notes_cache');
        webAppUrl = ""; accessKey = ""; isOfflineMode = false;
        showToast("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        setTimeout(() => location.reload(), 600);
    }

    function saveToCache(data) {
        try {
            const cacheData = data.map(n => {
                const s = { ...n };
                if (s.file_url?.startsWith('data:')) s.file_url = '';
                if (s.file_urls) s.file_urls = s.file_urls.map(u => u?.startsWith('data:') ? '' : u);
                return s;
            });
            localStorage.setItem('notes_cache', JSON.stringify(cacheData));
        } catch (e) { console.warn("Cache Full"); }
    }

    function loadFromCache() {
        const cached = localStorage.getItem('notes_cache');
        if (cached) { notes = JSON.parse(cached); refreshUI(); }
    }

    async function saveSettings() {
        const url = document.getElementById('settingUrlInput').value.trim();
        const key = document.getElementById('settingKeyInput').value.trim();
        if(!url || !key) return alert("URLê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

        showLoader(true, "ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...");
        try {
            const params = new URLSearchParams({ action: 'read', key: key, t: Date.now() });
            const res = await fetch(`${url}?${params.toString()}`, { redirect: "follow" });

            // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸ (GASê°€ HTML ì¸ì¦ í˜ì´ì§€ë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš° ë°©ì–´)
            let json;
            try {
                json = await res.json();
            } catch(parseErr) {
                console.error('[ì˜ê°ë…¸íŠ¸] GAS ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨ (JSONì´ ì•„ë‹˜):', parseErr);
                alert("ì—°ë™ ì‹¤íŒ¨: ì„œë²„ê°€ ì˜¬ë°”ë¥¸ ì‘ë‹µì„ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n[í•´ê²°ë°©ë²•] Google Apps Script ë°°í¬ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”:\nÂ· ì‹¤í–‰ ê³„ì •: ë‚˜(ë‚´ ê³„ì •)\nÂ· ì•¡ì„¸ìŠ¤ ê¶Œí•œ: ëª¨ë“  ì‚¬ìš©ì(ìµëª… í¬í•¨)\nÂ· ì½”ë“œ ìˆ˜ì • í›„ 'ìƒˆ ë°°í¬'ë¥¼ ìƒì„±í–ˆëŠ”ì§€ í™•ì¸");
                return;
            }

            if(json.status === 'success') {
                localStorage.setItem('inspirationNote_Url', url);
                localStorage.setItem('inspirationNote_Key', key);
                localStorage.removeItem('inspirationNote_Offline');
                webAppUrl = url; accessKey = key; isOfflineMode = false;
                alert("ì—°ê²° ì„±ê³µ! âœ“");
                closeModal('settingsModal');
                initApp();
            } else if(json.message && json.message.includes('í‚¤')) {
                alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            } else {
                console.error('[ì˜ê°ë…¸íŠ¸] GAS ì˜¤ë¥˜ ì‘ë‹µ:', json);
                alert(`ì—°ë™ ì‹¤íŒ¨: ${json.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
            }
        } catch (e) {
            console.error('[ì˜ê°ë…¸íŠ¸] ì—°ê²° ì˜¤ë¥˜ (ë¸Œë¼ìš°ì € ì½˜ì†” F12ì—ì„œ í™•ì¸):', e);
            if(e instanceof TypeError) {
                alert("ì—°ë™ ì‹¤íŒ¨: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” CORS ì°¨ë‹¨\n\n[í•´ê²°ë°©ë²•]\n1. GAS ì›¹ì•± URLì´ ì •í™•í•œì§€ í™•ì¸\n2. GAS ë°°í¬ ì„¤ì •: ì‹¤í–‰ê³„ì •=ë‚˜, ì•¡ì„¸ìŠ¤=ëª¨ë“  ì‚¬ìš©ì\n3. ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìƒì„¸ ì˜¤ë¥˜ í™•ì¸");
            } else {
                alert(`ì—°ë™ ì‹¤íŒ¨: ${e.message || 'URLì„ í™•ì¸í•˜ì„¸ìš”.'}\në¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
            }
        }
        finally { showLoader(false); }
    }

    function enableOfflineMode() {
        localStorage.setItem('inspirationNote_Offline', 'true');
        isOfflineMode = true;
        closeModal('settingsModal');
        initApp();
        showToast("ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì‹œì‘");
    }

    function getYoutubeId(url) {
        if (!url) return null;
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    function filterByTag(tag) {
        const searchInput = document.getElementById('searchInput');
        if(searchInput) {
            searchInput.value = tag;
            viewState.search = tag;
            closeModal('detailModal');
            refreshUI();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    function refreshUI() {
        const container = document.getElementById('mainContent');
        if (!container) return;
        container.innerHTML = '';
        
        let list = notes.filter(n => {
            const matchCat = viewState.cat === 'all' || n.category === viewState.cat;
            const matchFolder = viewState.folder === 'all' || n.folder === viewState.folder;
            const term = viewState.search.toLowerCase();
            const matchSearch = !viewState.search ||
                (n.title || '').toLowerCase().includes(term) ||
                (n.content || '').toLowerCase().includes(term) ||
                (n.tags || []).some(t => t.toLowerCase().includes(term));
            return matchCat && matchFolder && matchSearch;
        });

        list.sort((a, b) => {
            if (viewState.sort === 'date-desc') return Number(b.id) - Number(a.id);
            if (viewState.sort === 'date-asc')  return Number(a.id) - Number(b.id);
            return a.title.localeCompare(b.title, 'ko');
        });

        if (list.length === 0) {
            container.className = 'content-area';
            container.innerHTML = `<div class="empty-msg"><span class="material-symbols-outlined">ev_shadow</span><p>í‘œì‹œí•  ì˜ê°ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
        } else {
            container.className = viewState.mode === 'grid' ? `content-area grid-view grid-cols-${viewState.gridCols}` : 'content-area list-view';
            list.forEach(note => {
                const el = document.createElement('div');
                const engCat = catMap[note.category] || 'ETC';
                const cIcon = catIcon[note.category] || 'ri-file-text-line';
                const tagsHTML = (note.tags || []).map(t => `<span class="tag" style="font-size:0.75rem; color:var(--main); background:var(--bg); padding:4px 10px; border-radius:8px; font-weight:600; margin-right:5px;">${t}</span>`).join('');
                
                let preview = '';
                if(viewState.mode === 'grid') {
                    if (note.file_url && note.file_url.startsWith('data:image')) {
                        preview = `<div class="card-preview"><img src="${note.file_url}"></div>`;
                    } else if (note.file_url) {
                        const driveId = getGoogleDriveId(note.file_url);
                        if (driveId) preview = `<div class="card-preview"><img src="https://drive.google.com/thumbnail?sz=w500&id=${driveId}" style="width:100%; height:100%; object-fit:cover;"></div>`;
                    }
                }

                let linkLabel = '';
                if (note.link) {
                    const isYT = getYoutubeId(note.link);
                    linkLabel = `<div class="card-link"><i class="${isYT ? 'ri-youtube-fill' : 'ri-link'}"></i> ${note.link}</div>`;
                }

                if (viewState.mode === 'grid') {
                    el.className = 'card';
                    el.innerHTML = `<div class="card-meta"><div><span class="badge badge-cat">${engCat}</span><span class="badge badge-folder">${note.folder}</span></div><span>${note.date}</span></div><div class="card-title">${note.title}</div><div class="card-content">${note.content}</div>${preview}${linkLabel}<div class="card-tags">${tagsHTML}</div><div class="card-actions" onclick="event.stopPropagation()"><button class="action-btn" onclick="event.stopPropagation(); openEditModal('${note.id}')"><i class="ri-edit-line"></i></button><button class="action-btn del" onclick="event.stopPropagation(); deleteNote('${note.id}')"><i class="ri-delete-bin-line"></i></button></div>`;
                } else {
                    const listTagsHTML = (note.tags || []).map(t => `<span class="list-tag">${t}</span>`).join('');
                    el.className = 'list-item';
                    el.innerHTML = `
                        <div class="list-item-left">
                            <div class="list-icon"><i class="${cIcon}"></i></div>
                            <div class="list-content-wrap">
                                <div class="list-title">${note.title}</div>
                                <div class="list-preview">${note.content || ''}</div>
                                <div class="list-meta">
                                    <span class="badge-text">${engCat}</span> Â· ${note.folder} Â· ${note.date}
                                    ${note.link ? 'Â· <i class="ri-link" style="font-size:0.7rem"></i>' : ''}
                                </div>
                                <div class="list-tags">${listTagsHTML}</div>
                            </div>
                        </div>
                        <div class="list-actions" onclick="event.stopPropagation()">
                            <button class="action-btn" onclick="event.stopPropagation(); openEditModal('${note.id}')"><i class="ri-edit-line"></i></button>
                            <button class="action-btn del" onclick="event.stopPropagation(); deleteNote('${note.id}')"><i class="ri-delete-bin-line"></i></button>
                        </div>
                    `;
                }
                el.onclick = () => openDetail(note);
                container.appendChild(el);
            });
        }
        updateDashboard();
    }

    async function saveNote() {
        const title = document.getElementById('inputTitle').value;
        if (!title) return alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        const editId = document.getElementById('editNoteId').value;
        const now = Date.now();
        const existingNote = editId ? notes.find(n => n.id === editId) : null;
        const note = {
            id: editId || String(now),
            category: document.getElementById('inputCategory').value,
            folder: document.getElementById('folderSelect').value || 'ê¸°íƒ€',
            title: title,
            content: document.getElementById('inputContent').value,
            link: document.getElementById('inputLink').value.trim() || (existingNote ? existingNote.link : ''),
            tags: currentTags,
            date: new Date().toLocaleDateString(),
            created_at: existingNote ? existingNote.created_at : now
        };
        const newFiles = tempFiles.filter(f => !f.existing);
        const existingUrls = existingNote ? (existingNote.file_urls || (existingNote.file_url ? [existingNote.file_url] : [])) : [];
        const displayFileUrls = tempFiles.length ? tempFiles.map(f => f.data) : existingUrls;
        const displayFileUrl = displayFileUrls[0] || null;
        if (editId) notes = notes.map(n => n.id === editId ? {...note, file_url: displayFileUrl, file_urls: displayFileUrls} : n);
        else notes.unshift({...note, file_url: displayFileUrl, file_urls: displayFileUrls});
        saveToCache(notes); closeModal('writeModal'); refreshUI();
        if (!isOfflineMode && webAppUrl) {
            showLoader(true, "ì„œë²„ì— ì €ì¥ ì¤‘...");
            try {
                const payload = { action: editId ? 'update' : 'create', ...note, file: newFiles[0] || null, files: newFiles, key: accessKey };
                const res = await fetch(webAppUrl, { method: 'POST', body: JSON.stringify(payload), headers: { 'Content-Type': 'text/plain' }, redirect: 'follow' });
                const json = await res.json();
                if (json.status === 'success') { showToast('ì„œë²„ ì €ì¥ ì™„ë£Œ'); setTimeout(fetchNotes, 1000); }
            } catch(e) { showToast('ì„œë²„ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ'); }
            finally { showLoader(false); }
        }
    }

    async function deleteNote(id) {
        if(!confirm("ì˜êµ¬ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const targetId = String(id);
        notes = notes.filter(n => n.id !== targetId);
        saveToCache(notes); refreshUI();
        if(!isOfflineMode && webAppUrl) {
            try {
                const res = await fetch(webAppUrl, { method: 'POST', body: JSON.stringify({ action: 'delete', id: targetId, key: accessKey }), headers: { 'Content-Type': 'text/plain' }, redirect: 'follow' });
                const json = await res.json();
                if(json.status === 'success') showToast('ì„œë²„ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch(e) { showToast('ì„œë²„ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ'); }
        }
    }

    function setViewMode(m) {
        viewState.mode = m;
        document.querySelectorAll('.view-opts button').forEach(b => b.classList.remove('active'));
        if (m === 'list') {
            document.getElementById('btnViewList').classList.add('active');
        } else {
            const btn = document.getElementById('btnViewGrid' + viewState.gridCols);
            if (btn) btn.classList.add('active');
        }
        refreshUI();
    }
    function setGridView(cols) {
        viewState.mode = 'grid';
        viewState.gridCols = cols;
        localStorage.setItem('gridCols', cols);
        document.querySelectorAll('.view-opts button').forEach(b => b.classList.remove('active'));
        const btn = document.getElementById('btnViewGrid' + cols);
        if (btn) btn.classList.add('active');
        refreshUI();
    }
    async function syncFolders() {
        if (isOfflineMode || !webAppUrl || !accessKey) return;
        try {
            const payload = { action: 'saveFolders', folders: customFolders, key: accessKey };
            await fetch(webAppUrl, { method: 'POST', body: JSON.stringify(payload), headers: { 'Content-Type': 'text/plain' }, redirect: 'follow' });
        } catch(e) { console.warn('í´ë” ë™ê¸°í™” ì‹¤íŒ¨:', e); }
    }

    function openModal(id) {
        document.getElementById(id).style.display = 'flex';
        if (id === 'writeModal') {
            document.getElementById('modalTitle').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="1.4rem" viewBox="0 -960 960 960" width="1.4rem" style="fill:var(--main);flex-shrink:0;"><path d="M480-120q-66 0-113-47t-47-113H200q-33 0-56.5-23.5T120-360q0-140 92-241.5T440-718v-122h80v122q136 15 228 116.5T840-360q0 33-23.5 56.5T760-280H640q0 66-47 113t-113 47ZM200-360h560q0-116-82-198t-198-82q-116 0-198 82t-82 198Zm280 160q33 0 56.5-23.5T560-280H400q0 33 23.5 56.5T480-200Zm0-80Z"/></svg> ìƒˆë¡œìš´ ì˜ê°';
            document.getElementById('folderSelect').innerHTML = customFolders.map(f => `<option value="${f}">${f}</option>`).join('') + '<option value="ê¸°íƒ€">ê¸°íƒ€</option>';
            document.getElementById('editNoteId').value = "";
            document.querySelectorAll('#writeModal .form-input').forEach(i => i.value = "");
            tempFiles = []; renderFilePreviews(); currentTags = []; renderTags();
        }
    }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; if (id === 'detailModal' && history.state?.detailOpen) history.back(); }
    function showLoader(s, t) { document.getElementById('loader').style.display = s ? 'flex' : 'none'; if(t) document.getElementById('loaderText').innerText = t; }
    function showToast(m) { const t = document.createElement('div'); t.className='toast'; t.innerHTML=`<span>${m}</span>`; document.getElementById('toastContainer').appendChild(t); setTimeout(()=>t.remove(), 3000); }
    function setCategory(c) { viewState.cat = c; document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(catName[c]) || (c==='all' && b.innerText==='ì „ì²´'))); refreshUI(); }
    function setSortMode(s) { viewState.sort = s; refreshUI(); }
    function switchSettingTab(t) { document.querySelectorAll('.setting-tab').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.setting-content').forEach(x=>x.classList.remove('active')); document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).classList.add('active'); document.getElementById('content'+t.charAt(0).toUpperCase()+t.slice(1)).classList.add('active'); }
    function getGoogleDriveId(u) { if(!u) return null; let m = u.match(/[?&]id=([^&]+)/); if(m) return m[1]; m = u.match(/\/d\/([^/]+)/); if(m) return m[1]; return null; }
    function updateDashboard() { document.getElementById('dashTotal').innerText = notes.length; document.getElementById('dashText').innerText = notes.filter(n=>n.category==='text').length; document.getElementById('dashLife').innerText = notes.filter(n=>n.category==='daily').length; document.getElementById('dashArt').innerText = notes.filter(n=>n.category==='art').length; }
    function renderFolders() { const c = document.getElementById('foldersContainer'); c.innerHTML = `<span class="folder-chip ${viewState.folder==='all'?'active':''}" onclick="viewState.folder='all';renderFolders();refreshUI();">ì „ì²´ë³´ê¸°</span>` + customFolders.map(f => `<span class="folder-chip ${viewState.folder===f?'active':''}" onclick="viewState.folder='${f}';renderFolders();refreshUI();">${f}</span>`).join(''); }
    function addFolder() { const n = document.getElementById('newFolderName').value.trim(); if(n && !customFolders.includes(n)) { customFolders.push(n); localStorage.setItem('inspirationFolders', JSON.stringify(customFolders)); document.getElementById('newFolderName').value=''; renderFolders(); syncFolders(); } }
    function openFolderManage() { renderManageFolders(); openModal('folderManageModal'); }
    function renderManageFolders() {
        document.getElementById('manageFolderList').innerHTML = customFolders.map((f, i) =>
            `<div style="display:flex; justify-content:space-between; align-items:center; padding:10px; background:#f8f9fa; border-radius:10px; margin-bottom:5px;">
                <b>${escapeHtml(f)}</b>
                <button class="action-btn del" data-folder-index="${i}" title="ì‚­ì œ"><i class="ri-delete-bin-line"></i></button>
            </div>`
        ).join('');
        document.getElementById('manageFolderList').querySelectorAll('[data-folder-index]').forEach(btn => {
            btn.onclick = function() { openFolderDeleteChoice(parseInt(this.dataset.folderIndex)); };
        });
    }
    function openFolderDeleteChoice(idx) {
        const folderName = customFolders[idx];
        const noteCount = notes.filter(n => n.folder === folderName).length;
        document.getElementById('deleteChoiceText').innerText = `"${folderName}" í´ë” ì•ˆì— ë©”ëª¨ ${noteCount}ê°œê°€ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ì²˜ë¦¬í• ê¹Œìš”?`;
        document.getElementById('btnMoveToUnassigned').onclick = function() {
            notes = notes.map(n => n.folder === folderName ? {...n, folder: 'ê¸°íƒ€'} : n);
            saveToCache(notes);
            customFolders.splice(idx, 1);
            localStorage.setItem('inspirationFolders', JSON.stringify(customFolders));
            closeModal('folderDeleteChoiceModal');
            renderManageFolders(); renderFolders(); refreshUI();
            showToast('ë©”ëª¨ë¥¼ [ê¸°íƒ€]ë¡œ ì´ë™í•˜ê³  í´ë”ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.');
            syncFolders();
        };
        document.getElementById('btnDeleteAllNotes').onclick = function() {
            notes = notes.filter(n => n.folder !== folderName);
            saveToCache(notes);
            customFolders.splice(idx, 1);
            localStorage.setItem('inspirationFolders', JSON.stringify(customFolders));
            closeModal('folderDeleteChoiceModal');
            renderManageFolders(); renderFolders(); refreshUI();
            showToast('í´ë”ì™€ ë‚´ë¶€ ë©”ëª¨ë¥¼ ëª¨ë‘ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.');
            syncFolders();
        };
        openModal('folderDeleteChoiceModal');
    }
    function handleTagInput(e) { if(e.key==='Enter') { e.preventDefault(); addTag(e.target.value); } }
    function handleTagComma(e) { if(e.target.value.includes(',')) { e.target.value.split(',').forEach(t=>addTag(t)); e.target.value=''; } }
    function addTag(t) { const s = t.trim().replace(/^#/,''); if(s && !currentTags.includes('#'+s)) { currentTags.push('#'+s); renderTags(); } document.getElementById('realTagInput').value=''; }
    function renderTags() { const c = document.getElementById('tagInputContainer'); const i = document.getElementById('realTagInput'); Array.from(c.children).forEach(x=>{if(x!==i)x.remove()}); currentTags.forEach((t,x)=>{ const s=document.createElement('span'); s.className='tag-block'; s.innerHTML=`${t} <i class="ri-close-line" onclick="currentTags.splice(${x},1);renderTags();"></i>`; c.insertBefore(s,i); }); }
    function handleFileSelect(input) {
        const files = Array.from(input.files);
        if (!files.length) return;
        files.forEach(f => { const r=new FileReader(); r.onload=(e)=>{ tempFiles.push({name:f.name, type:f.type, data:e.target.result}); renderFilePreviews(); }; r.readAsDataURL(f); });
        input.value = '';
    }
    function handlePaste(e) {
        const modal = document.getElementById('writeModal');
        if (!modal || modal.style.display === 'none') return;
        const items = (e.clipboardData || e.originalEvent?.clipboardData)?.items;
        if (!items) return;
        for (const item of items) {
            if (!item.type.startsWith('image/')) continue;
            const file = item.getAsFile();
            if (!file) continue;
            const r = new FileReader();
            r.onload = (ev) => { const ext=item.type.split('/')[1]||'png'; tempFiles.push({name:`clipboard_${Date.now()}.${ext}`, type:item.type, data:ev.target.result}); renderFilePreviews(); };
            r.readAsDataURL(file);
            e.preventDefault();
            break;
        }
    }
    function removeFile(i) { tempFiles.splice(i, 1); renderFilePreviews(); }
    function renderFilePreviews() {
        const area = document.getElementById('filePreviewArea');
        if (!tempFiles.length) { area.style.display='none'; return; }
        area.style.display = 'flex';
        area.innerHTML = tempFiles.map((f,i) => {
            const thumb = f.type.startsWith('image/')
                ? `<img src="${f.data}" style="width:72px;height:72px;object-fit:cover;border-radius:10px;display:block;">`
                : `<div style="width:72px;height:72px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#f0f0f0;border-radius:10px;gap:3px;padding:4px;"><i class="ri-file-line" style="font-size:1.6rem;color:var(--main);"></i><span style="font-size:0.6rem;color:#666;text-align:center;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;">${f.name}</span></div>`;
            return `<div style="position:relative;flex-shrink:0;">${thumb}<button onclick="removeFile(${i})" style="position:absolute;top:-6px;right:-6px;width:20px;height:20px;border-radius:50%;background:#e74c3c;border:none;color:#fff;cursor:pointer;font-size:0.8rem;padding:0;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 5px rgba(0,0,0,0.2);">Ã—</button></div>`;
        }).join('');
    }
    function openEditModal(id) { const n=notes.find(x=>x.id===id); if(!n) return; openModal('writeModal'); document.getElementById('modalTitle').innerHTML="âœï¸ ì˜ê° ìˆ˜ì •"; document.getElementById('editNoteId').value=id; document.getElementById('inputCategory').value=n.category; document.getElementById('folderSelect').value=n.folder; document.getElementById('inputTitle').value=n.title; document.getElementById('inputContent').value=n.content || ''; document.getElementById('inputLink').value=n.link || ''; currentTags=[...(n.tags||[])]; renderTags(); const existingUrls=n.file_urls||(n.file_url?[n.file_url]:[]); tempFiles=existingUrls.map((url,idx)=>({name:idx===0?'ê¸°ì¡´ íŒŒì¼':`ê¸°ì¡´ íŒŒì¼ ${idx+1}`, type:url.startsWith('data:image')?'image/jpeg':'application/octet-stream', data:url, existing:true})); renderFilePreviews(); }
    
    let _sliderTouchX = 0;
    function sliderNav(dir) { const s=document.getElementById('mediaSlider'); if(!s) return; sliderGoto((parseInt(s.dataset.current)+dir+parseInt(s.dataset.total))%parseInt(s.dataset.total)); }
    function sliderGoto(i) { const s=document.getElementById('mediaSlider'); if(!s) return; s.dataset.current=i; document.getElementById('sliderTrack').style.transform=`translateX(-${i*100}%)`; document.querySelectorAll('#sliderDots span').forEach((d,idx)=>{ d.style.opacity=idx===i?'1':'0.4'; d.style.width=idx===i?'20px':'8px'; }); }
    function sliderTouchStart(e) { _sliderTouchX = e.touches[0].clientX; }
    function sliderTouchEnd(e) { const diff=_sliderTouchX-e.changedTouches[0].clientX; if(Math.abs(diff)>40) sliderNav(diff>0?1:-1); }
    function buildMediaSlider(fileUrls) {
        if (!fileUrls.length) return '';
        const renderItem = url => {
            if (url.startsWith('data:image')) return `<img src="${url}" style="width:100%;max-height:420px;object-fit:contain;display:block;border-radius:12px;">`;
            const d = getGoogleDriveId(url);
            if (d) return `<iframe src="https://drive.google.com/file/d/${d}/preview" style="width:100%;height:380px;border:none;border-radius:12px;"></iframe>`;
            return `<div style="display:flex;align-items:center;justify-content:center;height:100px;"><a href="${url}" target="_blank" style="color:var(--main);font-weight:700;text-decoration:none;"><i class="ri-file-line"></i> íŒŒì¼ ë³´ê¸°</a></div>`;
        };
        if (fileUrls.length === 1) return `<div style="margin-top:20px;">${renderItem(fileUrls[0])}</div>`;
        const slides = fileUrls.map(u => `<div style="min-width:100%;box-sizing:border-box;">${renderItem(u)}</div>`).join('');
        const dots = fileUrls.map((_,i) => `<span onclick="sliderGoto(${i})" style="display:inline-block;height:8px;width:${i===0?'20px':'8px'};border-radius:4px;background:var(--main);opacity:${i===0?'1':'0.4'};cursor:pointer;transition:all 0.25s;margin:0 3px;"></span>`).join('');
        return `<div id="mediaSlider" data-current="0" data-total="${fileUrls.length}" style="position:relative;margin-top:20px;border-radius:15px;overflow:hidden;background:var(--bg);padding-bottom:28px;" ontouchstart="sliderTouchStart(event)" ontouchend="sliderTouchEnd(event)">
            <div id="sliderTrack" style="display:flex;transition:transform 0.32s cubic-bezier(.4,0,.2,1);">${slides}</div>
            <button onclick="sliderNav(-1)" style="position:absolute;left:8px;top:calc(50% - 14px);transform:translateY(-50%);width:34px;height:34px;border-radius:50%;background:rgba(0,0,0,0.38);border:none;color:#fff;font-size:1.4rem;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2;line-height:1;">â€¹</button>
            <button onclick="sliderNav(1)" style="position:absolute;right:8px;top:calc(50% - 14px);transform:translateY(-50%);width:34px;height:34px;border-radius:50%;background:rgba(0,0,0,0.38);border:none;color:#fff;font-size:1.4rem;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2;line-height:1;">â€º</button>
            <div id="sliderDots" style="position:absolute;bottom:6px;left:0;right:0;text-align:center;z-index:2;">${dots}</div>
        </div>`;
    }

    function openDetail(n) {
        const c = document.getElementById('detailContent');
        const fileUrls = (n.file_urls || (n.file_url ? [n.file_url] : [])).filter(u => u);
        const mediaArea = buildMediaSlider(fileUrls);
        let linkArea = '';
        if (n.link) {
            const ytId = getYoutubeId(n.link);
            if (ytId) linkArea = `<div style="margin-top:20px;"><iframe width="100%" height="250" src="https://www.youtube.com/embed/${ytId}" frameborder="0" allowfullscreen style="border-radius:15px;"></iframe></div>`;
            linkArea += `<a href="${n.link}" target="_blank" style="display:block; padding:15px; background:#f8f9fa; border-radius:12px; margin-top:12px; color:#555; text-decoration:none; font-size:0.9rem; overflow:hidden; text-overflow:ellipsis;"><i class="ri-link"></i> ${n.link}</a>`;
        }
        c.innerHTML = `
            <h2 style="font-weight:800; margin-top:0; line-height:1.4; font-size:1.6rem; color:var(--text);">${n.title}</h2>
            <div style="font-size:0.9rem; color:#888; margin-bottom:20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                <span style="font-weight:700; color:var(--main);">${catName[n.category]}</span> Â· <span>${n.folder}</span> Â· <span>${n.date}</span>
            </div>
            <div style="white-space:pre-wrap; line-height:1.8; color:#444; font-size:1.05rem; min-height: 100px;">${n.content}</div>
            ${linkArea}${mediaArea}
            <div style="margin-top:25px; display:flex; gap:8px; flex-wrap:wrap;">
                ${(n.tags || []).map(t=>`<span onclick="filterByTag('${t}')" style="padding:8px 16px; background:var(--bg); color:var(--main); border-radius:12px; font-size:0.85rem; font-weight:700; cursor:pointer; transition:var(--trans); border:1.5px solid transparent;" onmouseover="this.style.borderColor='var(--main)'" onmouseout="this.style.borderColor='transparent'">${t}</span>`).join('')}
            </div>
        `; 
        history.pushState({ detailOpen: true }, '');
        document.getElementById('detailModal').style.display='flex';
    }
    function exportData() { if(notes.length===0) return; const b=new Blob([JSON.stringify(notes,null,2)],{type:'application/json'}); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download='inspiration_backup.json'; a.click(); }
    function importData(i) { const f=i.files[0]; if(!f) return; const r=new FileReader(); r.onload=(e)=>{ try { notes=JSON.parse(e.target.result); saveToCache(notes); refreshUI(); alert("ë°ì´í„° ë³µêµ¬ ì™„ë£Œ!"); } catch(e) { alert("ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤."); } }; r.readAsText(f); }
</script>

</body>
</html>